<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Konsultasi Gejala - Asisten Dokter Virtual</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f3f9ff 0%, #e6f0ff 100%);
        }
        #transcript-area::-webkit-scrollbar { width: 6px; }
        #transcript-area::-webkit-scrollbar-track { background: #e2e8f0; border-radius: 10px; } /* slate-200 */
        #transcript-area::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; } /* slate-400 */
        #transcript-area::-webkit-scrollbar-thumb:hover { background: #64748b; } /* slate-500 */
        .swal2-container { z-index: 10000 !important; }
        #leaflet-map-hasil {
            height: 250px; width: 100%; margin-top: 15px;
            border-radius: 0.75rem; border: 1px solid #d1d5db; z-index: 1; /* gray-300 */
        }
         @keyframes listening-pulse {
             0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.6); } /* red-500 */
             70% { box-shadow: 0 0 0 12px rgba(239, 68, 68, 0); }
        }
        /* Tombol dengar saat aktif (merah) */
        #listenButton.listening {
             animation: listening-pulse 1.8s infinite;
             background-image: linear-gradient(to right, #ef4444, #dc2626); /* red-500 to red-600 */
        }
         #listenButton.listening:hover {
             background-image: linear-gradient(to right, #dc2626, #b91c1c); /* red-600 to red-700 */
         }

        .sender-label { font-weight: 600; font-size: 0.75rem; display: block; margin-bottom: 2px; opacity: 0.75; }

        @keyframes pulse-indicator {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
        }
        #speaking-indicator {
            animation: pulse-indicator 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* --- Styling Bubble Chat (Tanpa @apply) --- */
        .chat-bubble {
            padding: 0.75rem; /* p-3 */
            border-radius: 0.75rem; /* rounded-xl */
            max-width: 85%;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); /* shadow-md */
            word-break: break-word;
            border-width: 1px;
            border-style: solid;
        }
        .user-transcript-bubble {
            background-image: linear-gradient(to bottom right, #3b82f6, #4f46e5); /* from-blue-500 to-indigo-600 */
            color: white;
            margin-left: auto; /* ml-auto */
            border-bottom-right-radius: 0.375rem; /* rounded-br-md */
            border-color: #1d4ed8; /* border-blue-700 */
        }
        .user-transcript-bubble .sender-label {
             color: #bfdbfe; /* text-blue-100 */
        }

        .bot-transcript-bubble {
             background-color: white;
             color: #1f2937; /* text-slate-800 */
             margin-right: auto; /* mr-auto */
             border-bottom-left-radius: 0.375rem; /* rounded-bl-md */
             border-color: #e5e7eb; /* border-slate-200 */
        }
         .bot-transcript-bubble .sender-label {
             color: #6b7280; /* text-slate-500 */
         }

         .bot-transcript-bubble.detection-result {
             background-image: linear-gradient(to bottom right, #f0fdf4, #d1fae5); /* from-emerald-50 to-green-100 */
             border-width: 2px;
             border-color: #6ee7b7; /* border-green-300 */
             color: #065f46; /* text-green-900 */
         }
          .bot-transcript-bubble.detection-result .sender-label {
             color: #047857; /* text-green-700 */
         }
         .bot-transcript-bubble.detection-result ul { list-style: disc; margin-left: 1rem; margin-top: 0.25rem; font-size: 0.875rem; /* text-sm */ padding-left: 1rem;}
         .bot-transcript-bubble.detection-result li { margin-bottom: 0.375rem; /* mb-1.5 */ }

         /* Animasi dokter 'bernapas' */
         @keyframes doctor-breathing {
             0%, 100% { transform: scale(1); }
             50% { transform: scale(1.015); }
         }
         #doctor-image.bot-speaking {
             animation: doctor-breathing 3s ease-in-out infinite;
         }

    </style>
</head>
<body class="flex flex-col items-center min-h-screen p-4 md:p-8">

    <header class="text-center mb-8">
        <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2 flex items-center justify-center gap-3">
            <i class="fas fa-laptop-medical text-blue-600 text-3xl"></i>
            <span>Asisten Konsultasi Gejala</span>
        </h1>
        <p class="text-slate-600">Dapatkan analisis awal gejala Anda secara cepat.</p>
    </header>

    <div id="main-container" class="w-full max-w-5xl bg-white rounded-3xl shadow-xl p-6 md:p-8 flex flex-col md:flex-row gap-6 md:gap-10">

        <div class="w-full md:w-1/3 flex flex-col items-center p-4 bg-gradient-to-b from-blue-50 to-white rounded-2xl shadow-inner">
            <div class="w-40 h-64 md:w-48 md:h-72 rounded-xl overflow-hidden border-4 border-white shadow-lg mb-5 ring-4 ring-blue-100 relative transition-all duration-300">
                <img id="doctor-image" src="/component/dokter.png" alt="Gambar Dokter" class="w-full h-full object-cover transition-transform duration-300">
                 <div id="speaking-indicator" class="absolute bottom-1 right-1 bg-blue-500/90 backdrop-blur-sm text-white p-2 rounded-full text-xs shadow-md hidden items-center justify-center">
                    <i class="fas fa-volume-high fa-beat" style="--fa-beat-scale: 1.1;"></i>
                </div>
            </div>
             <p class="text-xl font-semibold text-slate-800 mb-1">Asisten Virtual</p>
             <p class="text-sm text-slate-500 mb-6 px-4 text-center">Saya siap mendengarkan keluhan Anda.</p>
            <div id="controls" class="flex flex-col items-center w-full gap-4 mt-auto pt-6 border-t border-slate-200">
                 <button id="listenButton" class="flex items-center justify-center gap-3 w-full max-w-[260px] bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 disabled:from-slate-400 disabled:to-slate-500 text-white font-semibold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:-translate-y-1 active:scale-95 disabled:opacity-70 disabled:cursor-not-allowed" disabled>
                     <i class="fas fa-microphone-alt text-xl"></i>
                     <span class="text-base">Mulai Bicara</span>
                 </button>
                <div id="status" class="text-slate-500 text-xs min-h-[1.5em] mt-2 text-center px-2"></div>
            </div>
        </div>

        <div class="w-full md:w-2/3 flex flex-col">
             <h2 class="text-xl font-semibold text-slate-800 mb-3 text-center md:text-left">Percakapan</h2>
            <div id="transcript-area" class="flex-grow w-full border border-slate-300 rounded-xl p-4 overflow-y-auto bg-slate-100 text-sm space-y-4 shadow-inner min-h-[400px] mb-4">
                 </div>
             <button id="showMapBtn" class="flex items-center justify-center gap-2 w-full max-w-xs self-center md:self-end bg-gradient-to-r from-teal-500 to-cyan-500 hover:from-teal-600 hover:to-cyan-600 disabled:from-slate-400 disabled:to-slate-500 text-white font-semibold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:-translate-y-1 active:scale-95 disabled:opacity-70 hidden">
                 <i class="fas fa-hospital-user"></i>
                 <span>Lihat RS & Reservasi</span>
             </button>
        </div>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.4/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/IDMNYU/p5.js-speech@latest/lib/p5.speech.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script src="sketch.js"></script> </body>
</html>
